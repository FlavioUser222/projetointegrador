<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclusive.com - Tecnologia Simplificada para Voc√™</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
</head>

<body>



    <div class="goBack">
        <a href="index.html"><img src="icons8-voltar-48.png" alt="botao para voltar"></a>
    </div>

    <div class="menu-hamburguer">
        <button id="menuToggle" class="menu-btn" aria-label="Abrir menu de acessibilidade"><img
                src="icons8-menu-quadrado-2-48.png" alt="Botao de menu"></button>

        <div class="accessibility-controls" role="toolbar" id="accessibilityMenu"
            aria-label="Ferramentas de acessibilidade">

            <button class="accessibility-btn" id="increaseFont" aria-label="Aumentar tamanho da fonte">A+</button>
            <button class="accessibility-btn" id="decreaseFont" aria-label="Diminuir tamanho da fonte">A-</button>
            <button class="accessibility-btn" id="toggleContrast" aria-label="Ativar modo escuro"><img
                    src="forma-de-fase-da-lua-crescente-com-duas-estrelas.png" alt=""></button>
            <button class="accessibility-btn" id="toggleVoice" aria-label="Ativar leitor de tela"><img
                    src="aumentar-o-volume.png" alt=""></button>
            <button class="accessibility-btn" id="btnDaltonismo" aria-label="Trocar cores do site"><img
                    src="oculos-escuros.png" alt=""></button>
            <a href="admin.html"><img src="engrenagem.png" alt="icone administrador"></a>
        </div>
    </div>
    </div>
    <header class="header">


        <div class="header-content">
            <img class="logo" src="logo.png" alt="Logo escrita Inclusive.com">
            <div class="textHeader">
                <h1 class="header-title">Inclusive.com</h1>
                <p class="header-subtitle">Tecnologia Simplificada para Voc√™</p>
            </div>

        </div>

    </header>

    <main class="container main-content">
        <div>
            <section class="hero">
                <h2 class="hero-title">Bem-vindo aos guias passo a passo Inclusive.com!</h2>

                <div class="tudo">
                    <h1 id="tituloVideo"></h1>

                    <div class="videoPlayer" id="videoPlayer">

                    </div>
                </div>

                <div class=""><a href="atividades.html"><button class="conceito">Atividades</button></a></div>

        </div>
        </div>
        </section>

    </main>


    <footer class="footer">
        <p class="footer-mensagem">Feito com üíô para facilitar o aprendizado digital</p>
        <p class="footer-credito">¬© 2025 Inclusive.com</p>
    </footer>

    <script src="script.js"></script>
</body>

<script>
    let listaDeVideos = []
    let avaliacoesUsuario = JSON.parse(localStorage.getItem("avaliacoes")) || {};


    async function mostrarVideos() {


        try {


            let res = await fetch("https://projeto-pi-onrender.onrender.com/videos")
            let divVideos = document.getElementById('videoPlayer')

            let resPercentual = await fetch('https://projeto-pi-onrender.onrender.com/avaliacoes/percentual')
            let listaPercentual = await resPercentual.json()

            listaDeVideos = await res.json()

            listaDeVideos.forEach(video => {
                let card = document.createElement('div')
                card.classList.add('video-card')

                let titulo = document.createElement('h3')
                titulo.innerText = video.nome


                let botaoDesc = document.createElement('button')
                botaoDesc.innerText = 'Saiba Mais'
                botaoDesc.className = 'btnSaibaMais';


                let div = document.createElement('div')
                div.className = 'saibaMais'
                div.style.display = 'none'; // Inicialmente escondida


                let descricao = document.createElement('p')
                descricao.innerText = video.descricao
                div.appendChild(descricao)


                let percentualObj = listaPercentual.find(p => p.video_id === video.id);
                let percentual = percentualObj ? parseFloat(Number(percentualObj.media).toFixed(1)) : 0;



                botaoDesc.addEventListener('click', () => {

                    if (div.style.display === 'block') {
                        div.style.display = 'none';
                    } else {
                        div.style.display = 'block';
                    }

                    if (!card.contains(div)) {
                        card.appendChild(div);
                    }
                })


                let divStarButtons = document.createElement('div')
                divStarButtons.className = "divStarButton"

                let ratingDiv = document.createElement('div');

                ratingDiv.classList.add('star-rating');
                ratingDiv.innerHTML = `
  <input type="radio" id="star5-${video.id}" name="rating-${video.id}" value="5"><label for="star5-${video.id}">‚òÖ</label>
  <input type="radio" id="star4-${video.id}" name="rating-${video.id}" value="4"><label for="star4-${video.id}">‚òÖ</label>
  <input type="radio" id="star3-${video.id}" name="rating-${video.id}" value="3"><label for="star3-${video.id}">‚òÖ</label>
  <input type="radio" id="star2-${video.id}" name="rating-${video.id}" value="2"><label for="star2-${video.id}">‚òÖ</label>
  <input type="radio" id="star1-${video.id}" name="rating-${video.id}" value="1"><label for="star1-${video.id}">‚òÖ</label>
`;

                const user_id = (() => {
                    let id = localStorage.getItem("user_id");
                    if (!id) {
                        id = crypto.randomUUID();
                        localStorage.setItem("user_id", id);
                    }
                    return id;
                })();


                ratingDiv.querySelectorAll('input').forEach(star => {
                    star.addEventListener('change', async (e) => {
                        const rating = e.target.value;
                        console.log(rating)
                        if (avaliacoesUsuario[video.id]) {
                            alert("‚ö†Ô∏è Voc√™ j√° avaliou este v√≠deo!");
                            ratingDiv.querySelector(`input[value="${avaliacoesUsuario[video.id]}"]`).checked = true;
                            return;
                        }

                        avaliacoesUsuario[video.id] = parseInt(rating);
                        localStorage.setItem("avaliacoes", JSON.stringify(avaliacoesUsuario));

                        const data = {
                            video_id: video.id,
                            user_id: user_id,
                            nota: parseInt(rating)
                        };

                        console.log(data)

                        try {
                            const response = await fetch('https://projeto-pi-onrender.onrender.com/avaliacao', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(data)
                            });
                            if (response.ok) {
                                alert(`‚≠ê Avalia√ß√£o enviada! Voc√™ deu ${rating} estrelas.`);
                            } else if (response.status == 400) {
                                const err = await response.json();
                                alert(`‚ö†Ô∏è ${err.error}`);
                            } else {
                                alert("‚ùå Erro ao enviar avalia√ß√£o");
                            }
                        } catch (error) {
                            console.error("Erro:", error);
                            alert("‚ö†Ô∏è Falha na conex√£o ao enviar avalia√ß√£o");
                        }
                    });
                });


                let vid = document.createElement('video')
                vid.poster = `https://projeto-pi-onrender.onrender.com/uploads/${video.thumbnail}`;
                vid.src = `https://projeto-pi-onrender.onrender.com/uploads/${video.video}`
                vid.controls = true
                vid.width = 320
                vid.height = 280

                let mediaSpan = document.createElement('span');
                mediaSpan.className = 'media-avaliacao';
                mediaSpan.innerText = `${percentual}`;

                card.appendChild(titulo)
                card.appendChild(vid)
                divStarButtons.appendChild(botaoDesc)
                divStarButtons.appendChild(ratingDiv)
                divStarButtons.appendChild(mediaSpan)
                card.appendChild(divStarButtons);
                divVideos.appendChild(card)
            });

        } catch (error) {
            console.log("Error", error)
            alert("Erro ao carregar videos")
        }

    }



    mostrarVideos()





</script>





</html>